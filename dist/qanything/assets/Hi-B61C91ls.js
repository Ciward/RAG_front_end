import{a as v}from"./axios-CCb-kr4I.js";import{E as d,r as L,_ as R,a as m,b as U,c as b,o as w,w as a,d as l,e as g,f as D,g as p,h as P,n as x}from"./index-BgCptZ8v.js";v.interceptors.response.use(e=>{if(e.status&&e.status==200&&e.data.status==500){d.error({message:e.data.msg});return}return e.data.msg&&d.success({message:e.data.msg}),e.data},e=>{e.response.status==504?d.error({message:"找不到服务器"}):e.response.status==403?d.error({message:"权限不足，请联系管理员"}):e.response.status==401?(d.error({message:"尚未登录，请登录"}),L.replace("/")):e.response.status==404?d.error({message:"服务器无法根据客户端的请求找到资源"}):e.response.status==500?d.error({message:"服务器内部错误，无法完成请求"}):e.response.data?d.error({message:e.response.data.msg}):d.error({message:"未知错误!"})});let _="127.0.0.1:8082";const E=(e,r)=>(console.log(`${_}${e}`),v({method:"get",url:`${_}${e}`,data:r})),q={name:"Login",data(){var e=(s,t,o)=>{t===""&&o(new Error("请输入昵称")),this.getRequest("user/checkNickname?nickname="+t).then(n=>{n!=0?o(new Error("该昵称已被注册")):o()})},r=(s,t,o)=>{t===""&&o(new Error("请输入用户名")),this.getRequest("/user/checkUsername?username="+t).then(n=>{n!=0?o(new Error("该用户名已被注册")):o()})},u=(s,t,o)=>{t===""?o(new Error("请输入密码")):(this.registerForm.checkPass!==""&&this.$refs.registerForm.validateField("checkPass"),o())},c=(s,t,o)=>{t===""?o(new Error("请再次输入密码")):t!==this.registerForm.password?o(new Error("两次输入密码不一致!")):o()};return{loginForm:{username:"",password:"",code:""},verifyCode:"/verifyCode",checked:!0,rules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],code:[{required:!0,message:"请输入验证码",trigger:"blur"}]},fullscreenLoading:!1,registerDialogVisible:!1,formLabelWidth:"120px",registerForm:{nickname:"",username:"",password:"",checkPass:"",userProfile:"default_head.jpg"},registerRules:{nickname:[{validator:e,trigger:"blur"}],username:[{validator:r,trigger:"blur"}],password:[{validator:u,trigger:"blur"}],checkPass:[{validator:c,trigger:"blur"}]},uploadDisabled:!1,fileList:[]}},methods:{submitLogin(){this.$refs.loginForm.validate(e=>{if(e)this.fullscreenLoading=!0,this.postKeyValueRequest("/doLogin",this.loginForm).then(r=>{if(setTimeout(()=>{this.fullscreenLoading=!1},1e3),r){this.$store.state.currentUser=r.obj,window.sessionStorage.setItem("user",JSON.stringify(r.obj));let u=this.$route.query.redirect;this.$router.replace(u=="/"||u==null?"/chatroom":u)}else this.changeverifyCode()});else return this.$message.error("用户名,密码和验证码都不能为空！"),!1})},gotoAdminLogin(){this.$router.replace("/adminlogin")},showRegistryDialog(){this.registerDialogVisible=!0},beforeAvatarUpload(e){let r=e.size/1024/1024<4;return r||this.$message.error("上传头像图片大小不能超过 4MB!"),r},closeRegisterDialog(e){this.registerForm={nickname:"",username:"",password:"",checkPass:"",userProfile:""},e()},submitRegisterForm(e){this.$refs[e].validate(r=>{if(r)this.postRequest("/user/register",this.registerForm).then(u=>{u&&(this.registerDialogVisible=!1,location.reload())});else return this.$message.error("请正确填写信息！"),console.log("error submit!!"),!1})},getMailVerifyCode(){E("/verifyCode").then(e=>{if(e){this.getCodeEnable=!0;let r=30,u=setInterval(()=>{this.getCodeBtnText=r--+"s内不能发送"},1e3);setTimeout(()=>{clearInterval(u),this.getCodeEnable=!1,this.getCodeBtnText="获取邮箱验证码"},3e4)}})}}},B={class:"loginContainer"},M=g("h3",{class:"loginTitle"},"大学生学业信息智能问答系统",-1),N=["src"],T=g("i",{class:"el-icon-plus"},null,-1),W=g("div",{slot:"tip",class:"el-upload__tip"},"只能上传不超过4MB的图片(可使用默认头像！)",-1),K={slot:"footer",class:"dialog-footer"};function j(e,r,u,c,s,t){const o=m("el-input"),n=m("el-form-item"),f=m("el-button"),h=m("el-form"),V=m("el-main"),F=m("el-upload"),y=m("el-dialog"),k=m("el-container"),C=U("loading");return w(),b(k,null,{default:a(()=>[l(V,null,{default:a(()=>[g("div",B,[l(h,{ref:"loginForm",rules:s.rules,model:s.loginForm,"label-width":"80px"},{default:a(()=>[M,l(n,{label:"用户名:",prop:"username"},{default:a(()=>[l(o,{modelValue:s.loginForm.username,"onUpdate:modelValue":r[0]||(r[0]=i=>s.loginForm.username=i),type:"text","auto-complete":"off",placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),l(n,{label:"密码:",prop:"password"},{default:a(()=>[l(o,{modelValue:s.loginForm.password,"onUpdate:modelValue":r[1]||(r[1]=i=>s.loginForm.password=i),type:"password","auto-complete":"off",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),l(n,{label:"验证码:",prop:"code"},{default:a(()=>[l(o,{modelValue:s.loginForm.code,"onUpdate:modelValue":r[2]||(r[2]=i=>s.loginForm.code=i),type:"text","auto-complete":"off",placeholder:"请输入验证码",style:{width:"150px"},onKeydown:D(t.submitLogin,["enter","native"])},null,8,["modelValue","onKeydown"]),g("img",{style:{"margin-bottom":"-8px","margin-left":"15px"},src:s.verifyCode,title:"点击切换验证码",onClick:r[3]||(r[3]=(...i)=>t.getMailVerifyCode&&t.getMailVerifyCode(...i))},null,8,N)]),_:1}),g("div",null,[l(f,{style:{width:"45%","margin-right":"15px"},onClick:t.showRegistryDialog},{default:a(()=>[p("注册")]),_:1},8,["onClick"]),P((w(),b(f,{type:"primary",style:{width:"45%"},onClick:t.submitLogin},{default:a(()=>[p("登录")]),_:1},8,["onClick"])),[[C,s.fullscreenLoading,void 0,{fullscreen:!0,lock:!0}]])])]),_:1},8,["rules","model"])])]),_:1}),l(y,{visible:s.registerDialogVisible,"onUpdate:visible":r[9]||(r[9]=i=>s.registerDialogVisible=i),title:"新用户注册","before-close":t.closeRegisterDialog,width:"30%"},{default:a(()=>[l(h,{ref:"registerForm",model:s.registerForm,"status-icon":"",rules:s.registerRules},{default:a(()=>[l(n,{label:"用户昵称：","label-width":s.formLabelWidth,prop:"nickname"},{default:a(()=>[l(o,{modelValue:s.registerForm.nickname,"onUpdate:modelValue":r[4]||(r[4]=i=>s.registerForm.nickname=i),autocomplete:"off"},null,8,["modelValue"])]),_:1},8,["label-width"]),l(n,{label:"登录用户名：","label-width":s.formLabelWidth,prop:"username"},{default:a(()=>[l(o,{modelValue:s.registerForm.username,"onUpdate:modelValue":r[5]||(r[5]=i=>s.registerForm.username=i),autocomplete:"off"},null,8,["modelValue"])]),_:1},8,["label-width"]),l(n,{label:"密码：","label-width":s.formLabelWidth,prop:"password"},{default:a(()=>[l(o,{modelValue:s.registerForm.password,"onUpdate:modelValue":r[6]||(r[6]=i=>s.registerForm.password=i),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1},8,["label-width"]),l(n,{label:"确认密码：","label-width":s.formLabelWidth,prop:"checkPass"},{default:a(()=>[l(o,{modelValue:s.registerForm.checkPass,"onUpdate:modelValue":r[7]||(r[7]=i=>s.registerForm.checkPass=i),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1},8,["label-width"]),l(n,{label:"用户头像：","label-width":s.formLabelWidth},{default:a(()=>[l(F,{ref:"upload",action:"/ossFileUpload?module=group-chat","list-type":"picture-card",class:x({disabled:s.uploadDisabled}),"before-upload":t.beforeAvatarUpload,"file-list":s.fileList,"on-progress":e.onProgress,"on-success":e.imgSuccess,"on-error":e.imgError,"on-remove":e.imgRemove},{default:a(()=>[T,W]),_:1},8,["class","before-upload","file-list","on-progress","on-success","on-error","on-remove"])]),_:1},8,["label-width"])]),_:1},8,["model","rules"]),g("div",K,[l(f,{type:"primary",style:{width:"100%"},onClick:r[8]||(r[8]=i=>t.submitRegisterForm("registerForm"))},{default:a(()=>[p("注册")]),_:1})])]),_:1},8,["visible","before-close"])]),_:1})}const S=R(q,[["render",j]]);export{S as default};
