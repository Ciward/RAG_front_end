import{_ as V,r as d,a as k,c as h,o as b,w as t,b as l,d as m,e as C,f,g as L,n as D}from"./index-DcxLPFQQ.js";const U={name:"Login",data(){var n=(e,s,o)=>{s===""&&o(new Error("请输入昵称")),this.getRequest("user/checkNickname?nickname="+s).then(a=>{a!=0?o(new Error("该昵称已被注册")):o()})},r=(e,s,o)=>{s===""&&o(new Error("请输入用户名")),this.getRequest("/user/checkUsername?username="+s).then(a=>{a!=0?o(new Error("该用户名已被注册")):o()})},u=(e,s,o)=>{s===""?o(new Error("请输入密码")):(this.registerForm.checkPass!==""&&this.$refs.registerForm.validateField("checkPass"),o())},p=(e,s,o)=>{s===""?o(new Error("请再次输入密码")):s!==this.registerForm.password?o(new Error("两次输入密码不一致!")):o()};return{loginForm:{username:"",password:"",code:""},verifyCode:"/verifyCode",checked:!0,rules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],code:[{required:!0,message:"请输入验证码",trigger:"blur"}]},fullscreenLoading:!1,registerDialogVisible:!1,formLabelWidth:"120px",registerForm:{nickname:"",username:"",password:"",checkPass:"",userProfile:"default_head.jpg"},registerRules:{nickname:[{validator:n,trigger:"blur"}],username:[{validator:r,trigger:"blur"}],password:[{validator:u,trigger:"blur"}],checkPass:[{validator:p,trigger:"blur"}]},uploadDisabled:!1,fileList:[]}},methods:{submitLogin(){this.$refs.loginForm.validate(n=>{if(n)this.fullscreenLoading=!0,this.postKeyValueRequest("/doLogin",this.loginForm).then(r=>{if(setTimeout(()=>{this.fullscreenLoading=!1},1e3),r){this.$store.state.currentUser=r.obj,window.sessionStorage.setItem("user",JSON.stringify(r.obj));let u=this.$route.query.redirect;this.$router.replace(u=="/"||u==null?"/chatroom":u)}else this.changeverifyCode()});else return this.$message.error("用户名,密码和验证码都不能为空！"),!1})},changeverifyCode(){this.verifyCode="/verifyCode?time="+new Date},gotoAdminLogin(){this.$router.replace("/adminlogin")},showRegistryDialog(){this.registerDialogVisible=!0},beforeAvatarUpload(n){let r=n.size/1024/1024<4;return r||this.$message.error("上传头像图片大小不能超过 4MB!"),r},closeRegisterDialog(n){this.registerForm={nickname:"",username:"",password:"",checkPass:"",userProfile:""},n()},submitRegisterForm(n){this.$refs[n].validate(r=>{if(r)this.postRequest("/user/register",this.registerForm).then(u=>{u&&(this.registerDialogVisible=!1,location.reload())});else return this.$message.error("请正确填写信息！"),console.log("error submit!!"),!1})}}},P={class:"loginContainer"},R=m("h3",{class:"loginTitle"},"大学生学业信息智能问答系统",-1),x=["src"],q=m("i",{class:"el-icon-plus"},null,-1),E=m("div",{slot:"tip",class:"el-upload__tip"},"只能上传不超过4MB的图片(可使用默认头像！)",-1),N={slot:"footer",class:"dialog-footer"};function W(n,r,u,p,e,s){const o=d("el-input"),a=d("el-form-item"),g=d("el-button"),c=d("el-form"),w=d("el-main"),_=d("el-upload"),v=d("el-dialog"),y=d("el-container"),F=k("loading");return b(),h(y,null,{default:t(()=>[l(w,null,{default:t(()=>[m("div",P,[l(c,{ref:"loginForm",rules:e.rules,model:e.loginForm,"label-width":"80px"},{default:t(()=>[R,l(a,{label:"用户名:",prop:"username"},{default:t(()=>[l(o,{modelValue:e.loginForm.username,"onUpdate:modelValue":r[0]||(r[0]=i=>e.loginForm.username=i),type:"text","auto-complete":"off",placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),l(a,{label:"密码:",prop:"password"},{default:t(()=>[l(o,{modelValue:e.loginForm.password,"onUpdate:modelValue":r[1]||(r[1]=i=>e.loginForm.password=i),type:"password","auto-complete":"off",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),l(a,{label:"验证码:",prop:"code"},{default:t(()=>[l(o,{modelValue:e.loginForm.code,"onUpdate:modelValue":r[2]||(r[2]=i=>e.loginForm.code=i),type:"text","auto-complete":"off",placeholder:"请输入验证码",style:{width:"150px"},onKeydown:C(s.submitLogin,["enter","native"])},null,8,["modelValue","onKeydown"]),m("img",{style:{"margin-bottom":"-8px","margin-left":"15px"},src:e.verifyCode,title:"点击切换验证码",onClick:r[3]||(r[3]=(...i)=>s.changeverifyCode&&s.changeverifyCode(...i))},null,8,x)]),_:1}),m("div",null,[l(g,{style:{width:"45%","margin-right":"15px"},onClick:s.showRegistryDialog},{default:t(()=>[f("注册")]),_:1},8,["onClick"]),L((b(),h(g,{type:"primary",style:{width:"45%"},onClick:s.submitLogin},{default:t(()=>[f("登录")]),_:1},8,["onClick"])),[[F,e.fullscreenLoading,void 0,{fullscreen:!0,lock:!0}]])])]),_:1},8,["rules","model"])])]),_:1}),l(v,{visible:e.registerDialogVisible,"onUpdate:visible":r[9]||(r[9]=i=>e.registerDialogVisible=i),title:"新用户注册","before-close":s.closeRegisterDialog,width:"30%"},{default:t(()=>[l(c,{ref:"registerForm",model:e.registerForm,"status-icon":"",rules:e.registerRules},{default:t(()=>[l(a,{label:"用户昵称：","label-width":e.formLabelWidth,prop:"nickname"},{default:t(()=>[l(o,{modelValue:e.registerForm.nickname,"onUpdate:modelValue":r[4]||(r[4]=i=>e.registerForm.nickname=i),autocomplete:"off"},null,8,["modelValue"])]),_:1},8,["label-width"]),l(a,{label:"登录用户名：","label-width":e.formLabelWidth,prop:"username"},{default:t(()=>[l(o,{modelValue:e.registerForm.username,"onUpdate:modelValue":r[5]||(r[5]=i=>e.registerForm.username=i),autocomplete:"off"},null,8,["modelValue"])]),_:1},8,["label-width"]),l(a,{label:"密码：","label-width":e.formLabelWidth,prop:"password"},{default:t(()=>[l(o,{modelValue:e.registerForm.password,"onUpdate:modelValue":r[6]||(r[6]=i=>e.registerForm.password=i),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1},8,["label-width"]),l(a,{label:"确认密码：","label-width":e.formLabelWidth,prop:"checkPass"},{default:t(()=>[l(o,{modelValue:e.registerForm.checkPass,"onUpdate:modelValue":r[7]||(r[7]=i=>e.registerForm.checkPass=i),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1},8,["label-width"]),l(a,{label:"用户头像：","label-width":e.formLabelWidth},{default:t(()=>[l(_,{ref:"upload",action:"/ossFileUpload?module=group-chat","list-type":"picture-card",class:D({disabled:e.uploadDisabled}),"before-upload":s.beforeAvatarUpload,"file-list":e.fileList,"on-progress":n.onProgress,"on-success":n.imgSuccess,"on-error":n.imgError,"on-remove":n.imgRemove},{default:t(()=>[q,E]),_:1},8,["class","before-upload","file-list","on-progress","on-success","on-error","on-remove"])]),_:1},8,["label-width"])]),_:1},8,["model","rules"]),m("div",N,[l(g,{type:"primary",style:{width:"100%"},onClick:r[8]||(r[8]=i=>s.submitRegisterForm("registerForm"))},{default:t(()=>[f("注册")]),_:1})])]),_:1},8,["visible","before-close"])]),_:1})}const K=V(U,[["render",W]]);export{K as default};
